# PVE 镜像一键转虚拟机工具

## 简介
这是一个用于 Proxmox VE (PVE) 的自动化脚本，旨在简化将磁盘镜像文件（如 `.img` 或 `.img.gz`）转换为 PVE 虚拟机的过程。它会自动处理镜像选择、虚拟机 ID 设置、存储选择、磁盘导入、启动配置以及 EFI 支持等步骤。

## 功能
- 自动检测当前目录和 PVE 默认 ISO 目录下的 `.img` 和 `.img.gz` 镜像文件。
- 允许用户选择要转换的镜像文件。
- 自动建议并允许用户设置新的虚拟机 ID。
- 列出可用的存储位置（lvmthin 或 zfspool），供用户选择磁盘存放位置。
- 自动化虚拟机创建过程，包括：
    - 创建具有默认配置（2 核 CPU / 2G 内存，网卡桥接至 `vmbr0`）的虚拟机。
    - 处理 `.gz` 压缩镜像的解压。
    - 将磁盘镜像导入到选定的存储。
    - 配置虚拟机的启动项和网卡。
    - 自动识别并支持 EFI 镜像，相应地设置引导模式（UEFI/SeaBIOS）并添加 EFI 分区。
- 清理临时文件。

## 使用方法 需要先创建虚拟机空壳，再使用脚本执行转换。

1.  **上传镜像文件**: 将您的 `.img` 或 `.img.gz` 镜像文件上传到 PVE 主机的任意目录，或者 `/var/lib/vz/template/iso/` 目录。
2.  **运行脚本**:
    -   **上传并执行**: 将 `pvezh.sh` 脚本上传到 PVE 主机，例如您的家目录。然后，通过以下命令赋予执行权限并运行：
        ```bash
        chmod +x pvezh.sh
        ./pvezh.sh
        ```
    -   **一键下载并执行 (如果脚本已托管)**: 如果脚本托管在某个 URL (例如 GitHub Gist 或仓库)，您可以使用 `wget` 命令直接下载、赋予权限并运行。请将 `[脚本的URL]` 替换为实际的脚本下载地址。
        ```bash
        wget -O pvezh.sh https://raw.githubusercontent.com/chengege666/pvezh/main/pvezh.sh && chmod +x pvezh.sh && ./pvezh.sh
        ```
3.  **按照提示操作**: 脚本会引导您完成以下步骤：
    - 选择要转换的镜像文件。
    - 输入新的虚拟机 ID（脚本会提供建议）。
    - 选择磁盘的目标存储位置。
4.  **确认并执行**: 确认配置信息后，脚本将自动执行转换过程。
5.  **启动虚拟机**: 转换完成后，您可以在 PVE 控制台启动新创建的虚拟机。

## 默认配置
- **CPU**: 2 核
- **内存**: 2 GB
- **网卡**: 桥接至 `vmbr0`
- **虚拟机名称**: ImmortalWrt-Auto (可根据脚本修改)
- **引导模式**: 自动检测 (SeaBIOS 或 UEFI)

## 注意事项
- 脚本需要 `qm` (Proxmox VE QEMU/KVM 管理工具) 和 `pvesm` (Proxmox VE 存储管理工具) 命令。
- 确保您有足够的权限执行脚本和在 PVE 上创建虚拟机。
- 脚本会尝试自动识别 EFI 镜像，但如果遇到问题，可能需要手动调整虚拟机配置。

## 贡献
欢迎对本项目进行贡献。如果您有任何改进建议或发现 Bug，请提交 Issue 或 Pull Request。

